# 战略设计

## 1. 战略设计的概念理解

战略设计是领域驱动设计中非常容易理解，但是也是领域驱动中非常不好把握的地方。

战略设计主要包括以下几个方面：

- 确定限界上下文

限界上下文是指一个特定的业务领域内的一组相关的概念、规则和约束条件。

这个边界是由业务需求和实现技术共同决定的，它可以是物理的、逻辑的或者是组织上的。在这个边界内，有着自己的术语、模型和规则，与其他限界上下文之间进行交互时需要进行显式的协调和翻译。

例如，在电商系统的设计中，订单、商品、用户、营销是分别是不同的业务概念，可以根据业务划分到不同的限界上下文中。

- 确定上下文映射

在战略设计阶段，我们可以明确不同地上下文之间如何进行协作。

- 划分子域

子域代表了业务领域中相对独立的部分。划分子域需要考虑业务上的相对独立性、可重用性和可扩展性等因素。一个好的子域应该具有清晰的业务边界和明确的职责范围，同时应该与其他子域之间保持松耦合的关系。

例如，在一个电商系统中，可以将订单、商品、用户等作为不同的子域：订单子域负责处理订单相关的业务逻辑，商品子域负责处理商品相关的业务逻辑，用户子域负责处理用户相关的业务逻辑。这样可以将系统分解为不同的部分，每个部分负责自己的业务逻辑，从而提高系统的可维护性和可扩展性。

- 设计聚合根

对限界上下文内的业务概念进行建模，得到一系列的实体和值对象，实体和值对象又形成聚合根。聚合根是实现业务逻辑的核心，它负责协调聚合内部对象之间的交互，同时也是聚合内部对象之间的唯一访问入口。

例如，在上面的电商系统中，订单可以作为聚合根，它包含了订单明细、收货地址等相关信息。订单负责维护订单明细和收货地址之间的关系，并且对外提供统一的接口，例如创建订单、查询订单等。

- 设计领域服务

不适合建模到实体中的行为，可以建模为领域服务。

- 维护通用语言

## 2. 战略设计的误区

战略设计本身只是系统的设计阶段，还没有落实到编码，如果把过多的精力都集中在战略设计阶段，忽视战术设计，最后肯定会回归到贫血模型，也就造成了当经领域驱动设计无法落地的尴尬局面。

许多团队产出了很多精美的战略设计架构图例，例如限界上下文划分图、子域划分图，然后做了精美的 PPT 在各大技术交流的会议上分享其 DDD 落地经验，其实他们只是画了几个图自嗨，充其量只能产出贫血模型的代码，并没有实践真正的领域驱动设计。

另外，由于战略设计对系统的限界上下文划分，和我们从前进行系统设计时并无太大的差异，都是对一个事物的描述，不可能领域驱动设计和传统的软件设计产生截然不同的建模结果。例如，即使开发者没有接触过 DDD ，也会自然而然地把订单和产品信息分成不同的模块去开发，因此很多准备接触 DDD 的人惊呼，这也叫领域驱动设计，不是换汤不换药吗？

因此，战略设计很重要，但是绝对不应该止步于战略设计。

战略设计部分，在《领域驱动设计》一书中位于第四部分，然而在《实现领域驱动设计》一书中位于第二章。《实现领域驱动设计》一书虽然按照总-分的结构行文，但是由于其影响力，使得许多人认为战略设计是 DDD 落地的先决条件，进而投入了大量的精力到战略设计阶段，使得战术设计被忽略。

本书将花费比较少的篇幅来介绍战略设计，更多地将关注点放在战术设计的落地上。

<!--@include: ../footer.md-->
